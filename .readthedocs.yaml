# /workspaces/supermd-sphinx/.readthedocs.yaml（仓库根目录）
version: 2

# 1. 切换到模板目录，匹配环境
build:
  working_dir: sphinx_template
  os: ubuntu-22.04
  tools:
    python: "3.12"

# 2. 规范python.install配置（解决之前的Missing key报错）
python:
  install:
    - requirements: sphinx_template/requirements.txt  # 有则保留，无则删除
    - path: .
      packages:
        - linkify-it-py

# 3. 关键：sphinx.builder用RTD允许的值（如html），但后续命令覆盖
sphinx:
  configuration: sphinx_template/source/conf.py
  builder: html  # 必须写RTD允许的值（html/htmldir等）
  fail_on_warning: false

# 4. 仅输出EPUB格式，删除PDF/HTML
formats:
  - epub

# 5. 核心：强制执行EPUB构建命令，忽略builder配置
commands:
  # 先清空build目录，再强制生成EPUB
  - rm -rf $SPHINX_BUILD/*
  - sphinx-build -b epub $SPHINX_SOURCE $SPHINX_BUILD/epub